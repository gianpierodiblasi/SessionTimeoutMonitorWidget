TW.Runtime.Widgets.sessiontimeoutmonitor=function(){var c=this,f,g=!1;this.runtimeProperties=function(){return{needsDataLoadingAndError:!1}};this.renderHtml=function(){return'<div class="widget-content widget-sessiontimeoutmonitor" style="display:none;"></div>'};this.serviceInvoked=function(b){"Start"===b?($(document).off("ajaxComplete.sessiontimeoutmonitorwidget_sessionTimeoutMonitor"),$(document).on("ajaxComplete.sessiontimeoutmonitorwidget_sessionTimeoutMonitor",function(a,b,d){a=new Date;a.setTime(a.getTime()+
864E5);document.cookie="sessionTimeoutMonitorLastAjax="+(new Date).toUTCString()+";expires="+a.toUTCString()+";path=/Thingworx"}),f=setInterval(function(){for(var a,b=decodeURIComponent(document.cookie).split(";"),d=0;d<b.length;d++){var e=b[d].trim();e.startsWith("sessionTimeoutMonitorLastAjax=")&&(a=e.substring(30))}if(a){b=c.getProperty("timeout");d=c.getProperty("debugMode");var f=c.getProperty("redirect");e=new Date;a=new Date(a);d&&console.log("Session Timeout Monitor -> timeout = "+b+", sessionTimeoutMonitorLastAjax = "+
a.toLocaleString()+", now = "+e.toLocaleString());a=e-a-6E4*b;if(g||-12E4<=a){var h=TW.Environment.queryIEMode();a=function(){h&&document.execCommand("ClearAuthenticationCache");window.location=f};(new ThingworxInvoker({entityType:"Server",entityName:"*",apiMethod:"POST",characteristic:"Services",target:"Logout"})).invokeService(a,a)}else-18E4<=a&&(g=!0,c.showPopup())}},6E4)):"SimulateMessage"===b&&c.showPopup()};this.showPopup=function(){var b=TW.Runtime.convertLocalizableString("[[SessionTimeoutMonitorWidget.sessiontimeoutmonitor.title]]",
"Session Timeout"),a=TW.Runtime.convertLocalizableString("[[SessionTimeoutMonitorWidget.sessiontimeoutmonitor.message]]","The session is about to expire, please reload the page."),c=TW.Runtime.convertLocalizableString("[[SessionTimeoutMonitorWidget.sessiontimeoutmonitor.button]]","Reload");$("<div class='widget-sessiontimeoutmonitor-popup'>  <img class='widget-sessiontimeoutmonitor-image' src='../Common/extensions/SessionTimeoutMonitorWidget/ui/sessiontimeoutmonitor/window.png'/>  <div class='widget-sessiontimeoutmonitor-text'>    <div class='widget-sessiontimeoutmonitor-title'>"+
b+"</div>    <div class='widget-sessiontimeoutmonitor-message'>"+a+"</div>  </div>  <div class='widget-sessiontimeoutmonitor-button'>"+c+"</div></div><div class='widget-sessiontimeoutmonitor-background'></div>").appendTo("body");$(".widget-sessiontimeoutmonitor-button").click(()=>location.reload())};this.updateProperty=function(b){-1!==["timeout","debugMode","redirect"].indexOf(b.TargetProperty)&&this.setProperty(b.TargetProperty,b.RawSinglePropertyValue)};this.beforeDestroy=function(){clearInterval(f);
try{console.log("Session Timeout Monitor -> Remove ajax complete event"),TW.log.info("Session Timeout Monitor -> Remove ajax complete event"),$(document).off("ajaxComplete.sessiontimeoutmonitorwidget_sessionTimeoutMonitor")}catch(b){TW.log.error("Session Timeout Monitor Before Destroy Error",b)}}};