TW.Runtime.Widgets.sessiontimeoutmonitor=function(){var c=this,e;this.runtimeProperties=function(){return{needsDataLoadingAndError:!1}};this.renderHtml=function(){return'<div class="widget-content widget-sessiontimeoutmonitor" style="display:none;"></div>'};this.serviceInvoked=function(a){"Start"===a?($(document).off("ajaxComplete.sessiontimeoutmonitorwidget_sessionTimeoutMonitor"),$(document).on("ajaxComplete.sessiontimeoutmonitorwidget_sessionTimeoutMonitor",function(b,a,d){b=new Date;b.setTime(b.getTime()+
864E5);document.cookie="sessionTimeoutMonitorLastAjax="+(new Date).toUTCString()+";expires="+b.toUTCString()+";path=/Thingworx"}),e=setInterval(function(){for(var b,a=decodeURIComponent(document.cookie).split(";"),d=0;d<a.length;d++){var f=a[d].trim();f.startsWith("sessionTimeoutMonitorLastAjax=")&&(b=f.substring(30))}if(b){a=c.getProperty("timeout");d=c.getProperty("debugMode");f=c.getProperty("redirect");var e=new Date;b=new Date(b);d&&console.log("Session Timeout Monitor -> timeout = "+a+", sessionTimeoutMonitorLastAjax = "+
b.toLocaleString()+", now = "+e.toLocaleString());diff=e-b-6E4*a;-6E4<=diff?location.replace(f):-12E4<=diff&&c.showPopup()}},6E4)):"SimulateMessage"===a&&c.showPopup()};this.showPopup=function(){var a=TW.Runtime.convertLocalizableString("[[SessionTimeoutMonitorWidget.sessiontimeoutmonitor.title]]","Session Timeout"),b=TW.Runtime.convertLocalizableString("[[SessionTimeoutMonitorWidget.sessiontimeoutmonitor.message]]","The session is about to expire, please reload the page."),c=TW.Runtime.convertLocalizableString("[[SessionTimeoutMonitorWidget.sessiontimeoutmonitor.button]]",
"Reload");$("<div class='widget-sessiontimeoutmonitor-popup'>  <img class='widget-sessiontimeoutmonitor-image' src='../Common/extensions/SessionTimeoutMonitorWidget/ui/sessiontimeoutmonitor/window.png'/>  <div class='widget-sessiontimeoutmonitor-text'>    <div class='widget-sessiontimeoutmonitor-title'>"+a+"</div>    <div class='widget-sessiontimeoutmonitor-message'>"+b+"</div>  </div>  <div class='widget-sessiontimeoutmonitor-button'>"+c+"</div></div><div class='widget-sessiontimeoutmonitor-background'></div>").appendTo("body");
$(".widget-sessiontimeoutmonitor-button").click(()=>location.reload())};this.updateProperty=function(a){-1!==["timeout","debugMode","redirect"].indexOf(a.TargetProperty)&&this.setProperty(a.TargetProperty,a.RawSinglePropertyValue)};this.beforeDestroy=function(){clearInterval(e);try{console.log("Session Timeout Monitor -> Remove ajax complete event"),TW.log.info("Session Timeout Monitor -> Remove ajax complete event"),$(document).off("ajaxComplete.sessiontimeoutmonitorwidget_sessionTimeoutMonitor")}catch(a){TW.log.error("Session Timeout Monitor Before Destroy Error",
a)}}};